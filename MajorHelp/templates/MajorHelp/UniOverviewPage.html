<!DOCTYPE html>
{% include "navbar.html" %}
{% include "footer.html" %}
<html lang="en">


<head>
    {% load static %}
    <style>
    </style>
    <link rel="stylesheet" href="{% static 'css/overview/UniOverview.css' %}">
    <meta charset="UTF-8">
    
</head>

<body style="--pc: {{ primary_color }}; --sc: {{ secondary_color }};">
    
    <title>{{ university.name }}</title>
    
    <!-- Back button on left -->
    <a href="javascript:history.back()" class="back-button" onclick="location.reload()">Go Back</a>
            
    <!-- Favorite button -->
    <button id="favorite-btn" class="favorite-btn" data-object-type="university" data-object-id="{{ university.id }}">
        {% if is_favorite %}
            ★ Remove from Favorites
        {% else %}
            ☆ Add to Favorites
        {% endif %}
    </button>


    <!-- show up a litte text under favorite button telling users to login or signup if they are not -->
    {% if not user.is_authenticated %}
        <p class="login-link">
            Want to save favorites? 
            <a href="{% url 'MajorHelp:login' %}">Log in</a> 
            or <a href="{% url 'MajorHelp:signup' %}">Sign up</a>.
        </p>
    {% endif %}
            
    <!-- Title and content below -->
    <h1>{{ university.name }}</h1>
    <h2>{{ university.location }}</h2>

        
        <div class="about-container">
            <h10> About: </h10> 
            <p1>{{ university.aboutText }}</p1>
        </div>
        <div class="body-section">
            <div class="ratings-section">
                <h3>Average Ratings:</h3>
                <p12> Leave a review by clicking a star to rate a category out of 5!</p12>
                {% if not user.is_authenticated and user.role != 'alumni' or user.role != 'current_student' %}
                <h4> Please log-in as a Current student or Alumni to leave a rating! </h4>
                {% endif %}
                <ul>
                    <!-- List of the ratings catagories for the university and buttons for each -->
                    <li>Campus: {{ university.campus_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="campus">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Athletics: {{ university.athletics_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}  
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="athletics">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Safety: {{ university.safety_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="safety">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Social Life: {{ university.social_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="social">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Professors: {{ university.professor_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="professor">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Dorms: {{ university.dorm_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="dorm">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                    <li>Dining: {{ university.dining_rating }}
                        {% if user.is_authenticated and user.role == 'alumni' or user.role == 'current_student' %}
                        <form action="{% url 'MajorHelp:submit-rating' university.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="category" value="dining">
                            <button type="submit" name="rating" value="5">5</button>
                            <button type="submit" name="rating" value="4">4</button>
                            <button type="submit" name="rating" value="3">3</button>
                            <button type="submit" name="rating" value="2">2</button>
                            <button type="submit" name="rating" value="1">21</button>
                        </form>
                        {% endif %}
                    </li>

                </ul>
            </div>

            <div class="stats-section">
                <h5>Statistics:</h5>
                <p2>Graduation Rate: <span style="color: #4fc7cf; font-weight: 800;">{{ university.GraduationRate }}%</span><br></p2>
                <p3>Total Undergrad Students: <span style="color: #4fc7cf; font-weight: 800;">{{ university.TotalUndergradStudents }}</span><br></p3>
                <p4>Total Grad Students: <span style="color: #4fc7cf; font-weight: 800;">{{ university.TotalGradStudents }}</span><br></p4>
            </div>

            <!-- Add image to body-->

        </div>

        <!-- Form for leaving a review, visible only to logged-in users -->
        {% if user.is_authenticated%}
            {%if user.role == 'alumni' or user.role == 'current_student'%}
                {%if not user_review%}
                    <div class="new-post-form">
                        <h6>Leave a Review:</h6>
                        <form action="{% url 'MajorHelp:create_review' user.username %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="university_id" value="{{ university.id }}">
                            <textarea class="review-input" name="review_text" placeholder="Leave your review..." required></textarea>
                            <p></p>
                            <button class="submit-review" type="submit">Submit Review</button>
                        </form>
                    </div>
                {% endif %}
            {% endif %}
        {% endif %}

        <!-- Display all reviews (visible to all users) -->
        <div class="review-list">

            {% if user.is_authenticated %}
                {% if user.role != 'alumni' and user.role != 'current_student' %}
                    <p11>You must be an Alumni or a Current Student to leave a review.<br></p11>
                {% endif %}
            {% else %}
                <p10>Please <a href="{% url 'MajorHelp:login' %}">log in</a> to leave a review.<br></p10>
            {% endif %}

            <h9>Reviews:</h9>
            {% if latest_post_list %}
                <ul>
                    {% for post in latest_post_list %}
                        <li>
                            <p5>"{{ post.review_text }}" <strong>By:</strong> {{ post.username }} on {{ post.pub_date }}</p5>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p6>No reviews yet. Add your own if your a Student or Alumni!</p6>
            {% endif %}
        </div>

        <div class="space">
            <p>_ </p>
            <p>_ </p>
            <p>_ </p>
            <p>_ </p>
            <p>_ </p>
            <p>_ </p>
        </div>

        <style>
            .space {
                visibility: hidden !important;
            }
            
        </style>

        <!-- javascript that makes sure that the favorites are 
            marked until they are changed. So favorite pages are marked and
            will show as the current status (added to favorites or not in favorites)
            and be accurate
        
            TLDR: the below javascript shows errors it is just in how it is styled
            that the red squiggly lines are showing for it. It still works with no issues
        -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const favoriteBtn = document.getElementById('favorite-btn');
            if (favoriteBtn) {
                // Initialize button state based on server-side value
                {% if is_favorite %}
                    favoriteBtn.classList.add('favorited');
                {% endif %}
                
                favoriteBtn.addEventListener('click', function() {
                    const objectType = this.getAttribute('data-object-type');
                    const objectId = this.getAttribute('data-object-id');
                    
                    fetch(`/toggle-favorite/${objectType}/${objectId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'Content-Type': 'application/json',
                        },
                        credentials: 'same-origin'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'added') {
                            this.innerHTML = '★ Remove from Favorites';
                            this.classList.add('favorited');
                        } else if (data.status === 'removed') {
                            this.innerHTML = '☆ Add to Favorites';
                            this.classList.remove('favorited');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            }
        });
    </script>

</body>
</html>